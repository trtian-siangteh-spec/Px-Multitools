<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Time Calculator</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
@import url('https://fonts.cdnfonts.com/css/sf-pro-display');

/* --- ADDED: Theme Variables --- */
:root {
    --ios-blue: #007aff;
    --ios-label-color-light: #000; /* Black text */
    --ios-label-color-dark: #fff; /* White text */
    
    --page-bg: #f0f1f5; /* Original light gradient start */
    --page-bg-gradient: linear-gradient(180deg, #f0f1f5 0%, #ffffff 100%);
    
    --ios-glass-bg: rgba(255, 255, 255, 0.65); /* Original glass */
    --ios-glass-border: rgba(230, 230, 235, 0.6); /* Original border */
    --ios-input-bg: rgba(255, 255, 255, 0.7); /* Original input */
    
    --theme-toggle-bg: rgba(0,0,0,0.05);
    --theme-toggle-icon: #333;
}

html[data-theme="dark"] {
    --page-bg: #000; /* Pure black background */
    --page-bg-gradient: linear-gradient(180deg, #000 0%, #000 100%);
    
    --ios-glass-bg: rgba(28, 28, 30, 0.7); /* iOS standard dark glass */
    --ios-glass-border: rgba(255, 255, 255, 0.15);
    --ios-input-bg: rgba(58, 58, 60, 0.5);
    
    --theme-toggle-bg: rgba(100,100,100,0.3);
    --theme-toggle-icon: #fff;
}
/* --- END: Theme Variables --- */

body {
  font-family:'SF Pro Display','SF Pro Text',-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  /* MODIFIED: Use theme variables */
  background-color: var(--page-bg);
  background-image: var(--page-bg-gradient);
  color: var(--ios-label-color-light);
  min-height:100vh;padding:2rem;
  transition: background 0.3s ease, color 0.3s ease;
}
/* MODIFIED: Add dark mode text */
html[data-theme="dark"] body {
    color: var(--ios-label-color-dark);
}

.glass-card {
  /* MODIFIED: Use theme variables */
  background: var(--ios-glass-bg);
  backdrop-filter:blur(25px)saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border-radius:25px;
  border: 1px solid var(--ios-glass-border);
  box-shadow:0 8px 32px rgba(0,0,0,0.08);
  transition:transform .2s,box-shadow .2s, background 0.3s ease, border 0.3s ease;
}
.glass-card:hover {transform:scale(1.02);box-shadow:0 12px 48px rgba(0,0,0,0.1);}

input, select {
  /* MODIFIED: Use theme variables */
  border: 1px solid var(--ios-glass-border);
  background: var(--ios-input-bg);
  text-align:center;font-size:18px;
  color: var(--ios-label-color-light); /* Will be overridden by dark */
  outline:none;width:80px;
  border-radius:10px;padding:6px 0;
  box-shadow:inset 0 1px 3px rgba(0,0,0,0.05);
  transition: background 0.3s ease, border 0.3s ease, color 0.3s ease;
}
/* MODIFIED: Add dark mode input/select text */
html[data-theme="dark"] input,
html[data-theme="dark"] select {
    color: var(--ios-label-color-dark);
}

input:focus, select:focus {border:2px solid var(--ios-blue);}

label {
  font-size:17px;
  /* MODIFIED: Use theme variables */
  color: var(--ios-label-color-light);
  font-weight:500;
  transition: color 0.3s ease;
}
/* MODIFIED: Add dark mode label text */
html[data-theme="dark"] label {
    color: var(--ios-label-color-dark);
}

button {
  background:linear-gradient(90deg,#007aff,#0a84ff);
  color:#fff;font-size:18px;font-weight:600;
  padding:14px;border-radius:18px;width:100%;
  transition:transform .15s,box-shadow .15s;
  box-shadow:0 8px 24px rgba(0,122,255,.4);
}
button:hover {transform:scale(1.03);box-shadow:0 12px 32px rgba(0,122,255,.5);}
.section-title {font-size:24px;font-weight:700;color:var(--ios-blue);margin-bottom:12px;}
.result-box {font-size:26px;font-weight:700;color:var(--ios-blue);text-align:center;margin-top:12px;}

/* Back Button (Themed) */
.back-btn {
  display:inline-flex;align-items:center;justify-content:center;
  width:38px;height:38px;border-radius:10px;
  /* MODIFIED: Use theme variables */
  border: 1px solid var(--ios-glass-border);
  background: var(--ios-input-bg);
  color: var(--ios-label-color-light);
  cursor:pointer;
  transition:transform .18s ease, box-shadow .18s ease, background 0.3s ease, border 0.3s ease, color 0.3s ease;
}
html[data-theme="dark"] .back-btn {
    color: var(--ios-label-color-dark);
}
.back-btn:hover {
  transform:scale(1.06);box-shadow:0 8px 24px rgba(2,6,23,0.08);
}

/* --- ADDED: Theme Toggle --- */
.theme-toggle {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 100;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: var(--theme-toggle-bg);
    border: none;
    color: var(--theme-toggle-icon);
    cursor: pointer;
    transition: background 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
}
.theme-toggle .icon-sun,
.theme-toggle .icon-moon {
    display: none;
}
html[data-theme="light"] .theme-toggle .icon-moon {
    display: inline;
}
html[data-theme="dark"] .theme-toggle .icon-sun {
    display: inline;
}
</style>

<script>
    (function() {
        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
        }
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        if (savedTheme) {
            setTheme(savedTheme);
        } else {
            setTheme(prefersDark ? 'dark' : 'light');
        }
    })();
</script>
</head>
<body>

<button id="themeToggle" class="theme-toggle" aria-label="Toggle theme">
    <span class="icon-sun">‚òÄÔ∏è</span>
    <span class="icon-moon">üåô</span>
</button>

<div class="max-w-3xl mx-auto space-y-8">
  <div class="flex items-center justify-between">
    <a href="home.html" class="back-btn">‚Üê</a>
    <h1 class="text-5xl font-extrabold text-center text-[#007aff] flex-1">Time Calculator</h1>
    <div class="w-10"></div> 
  </div>

  <div class="glass-card p-6 space-y-6">
    <div class="flex items-center justify-between">
      <h2 class="section-title">Insert Time</h2>
      <div class="flex items-center gap-2">
        <label for="formatSelect">Format:</label>
        <select id="formatSelect" onchange="toggleFormat()">
          <option value="24" selected>24-Hour</option>
          <option value="12">12-Hour</option>
        </select>
      </div>
    </div>

    <div class="flex flex-col md:flex-row justify-between gap-8">
      <div class="flex flex-col items-center gap-2">
        <label>Time to Insert</label>
        <div class="flex gap-2 items-center">
          <input type="number" id="A_h" placeholder="HH" min="0" max="23">
          <input type="number" id="A_m" placeholder="MM" min="0" max="59">
          <input type="number" id="A_s" placeholder="SS" min="0" max="59">
          <select id="A_ampm" class="hidden">
            <option>AM</option><option>PM</option>
          </select>
        </div>
      </div>
      <div class="flex flex-col items-center gap-2">
        <label>X Unknown</label>
        <div class="flex gap-2 items-center">
          <input type="number" id="B_h" placeholder="HH" min="0" max="23">
          <input type="number" id="B_m" placeholder="MM" min="0" max="59">
          <input type="number" id="B_s" placeholder="SS" min="0" max="59">
          <select id="B_ampm" class="hidden">
            <option>AM</option><option>PM</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <div class="glass-card p-6 space-y-4">
    <h2 class="section-title">Functions</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <button onclick="calculate('add')">‚ûï Add</button>
      <button onclick="calculate('subtract')">‚ûñ Subtract</button>
      <button onclick="antiOT()">üíº Anti-OT</button>
    </div>
    <div class="result-box" id="resultBox">Result: --:--:--</div>
  </div>
</div>

<script>
let currentResult = 0; // seconds
let is12Hour = false;

function toggleFormat(){
  const fmt = document.getElementById('formatSelect').value;
  is12Hour = (fmt === '12');
  document.getElementById('A_ampm').classList.toggle('hidden', !is12Hour);
  document.getElementById('B_ampm').classList.toggle('hidden', !is12Hour);
  // adjust max hours
  const maxHour = is12Hour ? 12 : 23;
  const minHour = is12Hour ? 1 : 0; // 12-hour starts at 1
  document.getElementById('A_h').max = maxHour;
  document.getElementById('B_h').max = maxHour;
  document.getElementById('A_h').min = minHour;
  document.getElementById('B_h').min = minHour;
}

function getTimeInSeconds(prefix){
  let h = +document.getElementById(prefix+'_h').value||0;
  const m = +document.getElementById(prefix+'_m').value||0;
  const s = +document.getElementById(prefix+'_s').value||0;
  if(is12Hour){
    const ampm = document.getElementById(prefix+'_ampm').value;
    if(ampm === 'PM' && h < 12) h += 12;
    if(ampm === 'AM' && h === 12) h = 0;
  }
  return h*3600 + m*60 + s;
}

function secondsToHMS(sec){
  sec = (sec%(24*3600) + 24*3600) % (24*3600);
  let h = Math.floor(sec/3600);
  const m = Math.floor((sec%3600)/60);
  const s = sec%60;

  if(is12Hour){
    const ampm = h >= 12 ? 'PM' : 'AM';
    h = h % 12; if(h === 0) h = 12;
    return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')} ${ampm}`;
  } else {
    return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  }
}

function calculate(mode){
  const A=getTimeInSeconds('A');
  const B=getTimeInSeconds('B');
  if(A===0 && B===0){alert('Please insert both times.');return;}
  let result = (mode==='add') ? A+B : A-B;
  currentResult = result;
  document.getElementById('resultBox').textContent=`Result: ${secondsToHMS(result)}`;
}

function antiOT(){
  const A=getTimeInSeconds('A');
  if(A===0){alert('Please insert Time to Insert first.');return;}
  const result=A+(9*3600+15*60);
  currentResult=result;
  document.getElementById('resultBox').textContent=`Anti-OT: ${secondsToHMS(result)}`;
}

// --- ADDED: Main script loader ---
document.addEventListener('DOMContentLoaded', function() {

    // --- ADDED: Security Check ---
    if (!sessionStorage.getItem('cm_v7_session')) {
        window.location.href = 'login.html';
        return; // Stop further execution
    }

    // --- ADDED: Theme Toggle Click Listener ---
    const htmlEl = document.documentElement;
    const themeToggle = document.getElementById('themeToggle');
    
    themeToggle.addEventListener('click', () => {
        const currentTheme = htmlEl.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        htmlEl.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
    });

    // Start inactivity timer (from your original script)
    resetInactivityTimer();
});


// Auto logout after 10 minutes of inactivity
let inactivityTimer;

function resetInactivityTimer() {
    clearTimeout(inactivityTimer);
    inactivityTimer = setTimeout(logout, 10 * 60 * 1000); // 10 minutes
}

// --- MODIFIED: Standardized logout function ---
function logout() {
    sessionStorage.removeItem('cm_v7_session'); // Use sessionStorage
    location.href = 'login.html'; // Correct path
}

// Reset timer on user activity
document.addEventListener('mousemove', resetInactivityTimer);
document.addEventListener('keypress', resetInactivityTimer);
document.addEventListener('click', resetInactivityTimer);
document.addEventListener('scroll', resetInactivityTimer);
document.addEventListener('touchstart', resetInactivityTimer);

// Note: Timer is now started inside DOMContentLoaded
</script>
</body>
</html>